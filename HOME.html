<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>DB</title>
	<style type="text/css">
		body {
			margin: 0;
			padding: 0;
		}
		#mapholder{
			height: 100vh;
			width: 100%;
		}
		#legend {
			font-family: Arial, sans-serif;
			background-color: #fff;
			padding: 10px;
			margin: 20px;
			border: 3px solid #000;
		}
		#legend h3 {
			margin-top: 0;
			text-align: center;
		}
		#legend img {
			margin-top: 10px;
			vertical-align: middle;
		}
	</style>
</head>
<body>
	<div id="demo"></div>
	<!-- <button onclick="getLocation()">获取地理位置</button> -->
	<div id="mapholder"></div>
	<div id="legend"><h3>legend</h3></div>

<script type="text/javascript">
	var mapholder = document.getElementById('mapholder')

	// 获取当前位置
	function getLocation() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(initMap, showError)
		} else {
			mapholder.innerHTML = "对不起，您的浏览器不支持获取地理位置"
		}
	}

	// 初始化地图
	function initMap(position) {
		// 经纬度
		var uluru = {lat: position.coords.latitude, lng: position.coords.longitude}

		// 新建地图
		var map = new google.maps.Map(mapholder,{
			zoom: 15,
			center: uluru,
			mapTypeId: 'roadmap',
			streetViewControl: false
		})

		// 定义marker图标
		var icons = {
			station: {
				name:"Station",
				icon: "images/station.png"
			},
			normal:{
				name:'Normal',
				icon:'images/normal.png'
			},
			full:{
				name:'Full',
				icon:'images/full.png'
			},
			timeout:{
				name:'Timeout',
				icon:'images/timeout.png'
			}
		}

		// 定义各标记点位置和类型
		var features = [{
			position:new google.maps.LatLng(28.184107599999997,112.93706379999999),
			type:'station'
		}, {
			position: new google.maps.LatLng(28.17843076567516,112.94081237997058),
			type: 'normal'
		}, {
			position: new google.maps.LatLng(28.18117333828266,112.9418959924126),
			type: 'normal'
		}, {
			position: new google.maps.LatLng(28.182506770586404, 112.9389777490044),
			type: 'normal'
		}, {
			position: new google.maps.LatLng(28.180691028882528, 112.93882754529956),
			type: 'full'
		}, {
				position: new google.maps.LatLng(28.179050214946194,112.9394820042992),
			type: 'full'
		}, {
			position: new google.maps.LatLng(28.181447591674516, 112.94039395536426),
			type: "timeout"
		}]

		// 添加marker函数
		var markerCluster
		function addMarker(feature) {
			var marker = new google.maps.Marker({
				position: feature.position,
				icon: icons[feature.type].icon,
				map: map
			})
			markerCluster = new MarkerClusterer(map, marker,{
				imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'
			});
		}

		// 依次添加所有marker
		for( var i = 0, feature; feature = features[i]; i++ ){
			addMarker(feature)
		}

		// 添加图例说明
		var legend = document.getElementById('legend')
		for(var key in icons) {
			var type = icons[key]
			var name = type.name
			var icon = type.icon
			var div = document.createElement('div')
			div.innerHTML = '<img src="' + icon + '">' + name
			legend.appendChild(div)
		}

		// var markerCluster = new MarkerClusterer(map, markers,{
		// 	imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'
		// });

		map.controls[google.maps.ControlPosition.RIGHT_TOP].push(legend)
	}

	// 错误处理函数
	function showError(e) {
		switch(e.code){
			case e.PERMISSION_DENIED:
				x.innerHTML = "用户拒绝对获取地理位置的请求"
				break
			case e.POSITION_UNAVAILABLE:
				x.innerHTML = "位置信息不可用"
				break
			case e.TIMEOUT:
				x.innerHTML = "请求超时"
				break
			case e.UNKOWN_ERROR:
				x.innerHTML = "未知错误"
				break
		}
	}
</script>
<!-- 标记聚类 -->
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQFOnPxnxdPO_vQK8YWrXvl4Np19N-w94&callback=getLocation" type="text/javascript"></script>
</body>
</html>